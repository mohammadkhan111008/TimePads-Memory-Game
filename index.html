
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TimePads Memory Game</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
      body {
        font-family: 'Poppins', sans-serif;
      }
    </style>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script type="importmap">
      {
        "imports": {
          "react": "https://esm.sh/react@18.2.0",
          "react-dom/client": "https://esm.sh/react-dom@18.2.0/client"
        }
      }
    </script>
  </head>
  <body class="bg-slate-900 text-white">
    <div id="root"></div>
    <script type="text/babel" data-type="module">
      import React, { useState, useEffect, useCallback } from 'react';
      import ReactDOM from 'react-dom/client';

      // --- From constants.ts ---
      const SEQUENCE_DELAY = 300; // ms between pads in a sequence
      const PAD_LIT_DURATION = 400; // ms a pad stays lit

      const PADS = [
        {
          id: 0,
          color: 'green',
          baseClasses: 'bg-green-700/60 hover:bg-green-600/80',
          activeClasses: 'bg-green-400 shadow-[0_0_20px_5px] shadow-green-400/50',
        },
        {
          id: 1,
          color: 'red',
          baseClasses: 'bg-red-700/60 hover:bg-red-600/80',
          activeClasses: 'bg-red-400 shadow-[0_0_20px_5px] shadow-red-400/50',
        },
        {
          id: 2,
          color: 'yellow',
          baseClasses: 'bg-yellow-700/60 hover:bg-yellow-600/80',
          activeClasses: 'bg-yellow-400 shadow-[0_0_20px_5px] shadow-yellow-400/50',
        },
        {
          id: 3,
          color: 'blue',
          baseClasses: 'bg-blue-700/60 hover:bg-blue-600/80',
          activeClasses: 'bg-blue-400 shadow-[0_0_20px_5px] shadow-blue-400/50',
        },
      ];

      // --- From components/Pad.tsx ---
      const Pad = ({ config, isActive, onClick, disabled }) => {
        const padClasses = `
          w-full h-full rounded-full
          transition-all duration-200 ease-in-out
          focus:outline-none
          ${isActive ? config.activeClasses : config.baseClasses}
          ${!disabled && !isActive ? 'cursor-pointer' : 'cursor-wait'}
          ${disabled && !isActive ? 'opacity-50' : ''}
        `;

        return (
          <div className="w-full h-full p-2 sm:p-4">
            <button
              onClick={onClick}
              disabled={disabled}
              className={padClasses}
              aria-label={`Game pad ${config.color}`}
            ></button>
          </div>
        );
      };

      // --- From components/GameControls.tsx ---
      const GameControls = ({ gameState, level, highScore, onStart }) => {
        const getStatusMessage = () => {
          switch (gameState) {
            case 'start':
              return 'Press Start to Play';
            case 'watching':
              return 'Watch carefully...';
            case 'playing':
              return 'Your turn!';
            case 'gameover':
              return `Game Over! You reached level ${level - 1}.`;
            default:
              return '';
          }
        };

        return (
          <div className="text-center space-y-4 my-6">
            <div className="flex justify-around items-center w-full max-w-xs mx-auto">
              <div className="text-lg">
                <span className="text-slate-400 block text-sm">LEVEL</span>
                <span className="font-bold text-2xl">{level > 0 ? level : '--'}</span>
              </div>
              <div className="text-lg">
                <span className="text-slate-400 block text-sm">HIGH SCORE</span>
                <span className="font-bold text-2xl">{highScore}</span>
              </div>
            </div>
            
            <p className="text-xl h-7 text-slate-300 transition-opacity duration-300">
              {getStatusMessage()}
            </p>

            {(gameState === 'start' || gameState === 'gameover') && (
              <button
                onClick={onStart}
                className="bg-indigo-600 hover:bg-indigo-500 text-white font-bold py-3 px-8 rounded-lg shadow-lg transition-transform transform hover:scale-105"
              >
                {gameState === 'start' ? 'Start Game' : 'Play Again'}
              </button>
            )}
          </div>
        );
      };

      // --- From App.tsx ---
      const App = () => {
        const [sequence, setSequence] = useState([]);
        const [userSequence, setUserSequence] = useState([]);
        const [level, setLevel] = useState(0);
        const [highScore, setHighScore] = useState(() => {
          const savedScore = localStorage.getItem('timepadsHighScore');
          return savedScore ? parseInt(savedScore, 10) : 0;
        });
        const [gameState, setGameState] = useState('start');
        const [activePad, setActivePad] = useState(null);

        const sleep = (ms) => new Promise(resolve => setTimeout(resolve, ms));

        const playSequence = useCallback(async (currentSequence) => {
          setGameState('watching');
          await sleep(SEQUENCE_DELAY * 2);
          for (const padId of currentSequence) {
            setActivePad(padId);
            await sleep(PAD_LIT_DURATION);
            setActivePad(null);
            await sleep(SEQUENCE_DELAY);
          }
          setGameState('playing');
        }, []);

        const nextLevel = useCallback(() => {
          setUserSequence([]);
          const newPadId = Math.floor(Math.random() * PADS.length);
          const newSequence = [...sequence, newPadId];
          setSequence(newSequence);
          setLevel(prev => prev + 1);
          playSequence(newSequence);
        }, [sequence, playSequence]);

        const handleStartGame = () => {
          setSequence([]);
          setUserSequence([]);
          setLevel(0);
          setGameState('watching');
          setTimeout(() => {
            const firstPadId = Math.floor(Math.random() * PADS.length);
            const firstSequence = [firstPadId];
            setSequence(firstSequence);
            setLevel(1);
            playSequence(firstSequence);
          }, 100);
        };
        
        const handlePadClick = (padId) => {
          if (gameState !== 'playing') return;
          setUserSequence(current => [...current, padId]);
        };

        const handleGameOver = useCallback(() => {
          const finalScore = level - 1;
          if (finalScore > highScore) {
            setHighScore(finalScore);
            localStorage.setItem('timepadsHighScore', String(finalScore));
          }
          setGameState('gameover');
        }, [level, highScore]);
        
        useEffect(() => {
          if (userSequence.length === 0 || gameState !== 'playing') return;

          const index = userSequence.length - 1;
          if (userSequence[index] !== sequence[index]) {
            handleGameOver();
            return;
          }

          if (userSequence.length === sequence.length) {
            setTimeout(nextLevel, 1000);
          }
        }, [userSequence, sequence, gameState, nextLevel, handleGameOver]);

        return (
          <div className="min-h-screen flex flex-col items-center justify-center p-4 bg-slate-900">
            <header className="text-center mb-4">
              <h1 className="text-4xl md:text-5xl font-bold tracking-wider text-transparent bg-clip-text bg-gradient-to-r from-indigo-400 to-cyan-400">
                TimePads
              </h1>
              <p className="text-slate-400">A test of memory and focus</p>
            </header>

            <main className="w-full max-w-md md:max-w-lg mx-auto flex flex-col">
              <div className="relative aspect-square w-full rounded-full bg-slate-800 shadow-2xl shadow-slate-950/50 p-4">
                <div className="grid grid-cols-2 grid-rows-2 gap-4 w-full h-full">
                  {PADS.map(pad => (
                    <Pad
                      key={pad.id}
                      config={pad}
                      isActive={activePad === pad.id}
                      onClick={() => handlePadClick(pad.id)}
                      disabled={gameState !== 'playing'}
                    />
                  ))}
                </div>
                <div className="absolute inset-0 flex items-center justify-center pointer-events-none">
                  <div className="w-40 h-40 bg-slate-900 rounded-full flex items-center justify-center shadow-inner">
                  </div>
                </div>
              </div>

              <GameControls
                gameState={gameState}
                level={level}
                highScore={highScore}
                onStart={handleStartGame}
              />
            </main>
          </div>
        );
      };
      
      // --- From index.tsx ---
      const rootElement = document.getElementById('root');
      if (!rootElement) {
        throw new Error("Could not find root element to mount to");
      }

      const root = ReactDOM.createRoot(rootElement);
      root.render(
        <React.StrictMode>
          <App />
        </React.StrictMode>
      );
    </script>
  </body>
</html>
